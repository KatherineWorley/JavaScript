(function(e,t){'object'==typeof exports&&'undefined'!=typeof module?module.exports=t():'function'==typeof define&&define.amd?define(t):e.rough=t()})(this,function(){'use strict';function e(e,t){return e.type===t}function t(e){const t=e[0],i=e[1];return y(g(t[0]-i[0],2)+g(t[1]-i[1],2))}function i(e,t){const n=[],s=new A([e[0],e[1]],[e[2],e[3]]);for(let a=0;a<t.length;a++){const e=new A(t[a],t[(a+1)%t.length]);s.intersects(e)&&n.push([s.xi,s.yi])}return n}function n(e,t,i,n,s,a,l){return[-i*a-n*s+i+a*e+s*t,l*(i*s-n*a)+n+-l*s*e+l*a*t]}function s(e,t){const n=[];if(e&&e.length){let s=e[0][0],a=e[0][0],l=e[0][1],o=e[0][1];for(let t=1;t<e.length;t++)s=f(s,e[t][0]),a=d(a,e[t][0]),l=f(l,e[t][1]),o=d(o,e[t][1]);const r=t.hachureAngle;let h=t.hachureGap;0>h&&(h=4*t.strokeWidth),h=d(h,.1);const g=r%180*(b/180),c=_(g),u=m(g),y=p(g),x=new S(l-1,o+1,s-1,a+1,h,u,c,y);for(let t;null!=(t=x.nextLine());){const s=i(t,e);for(let e=0;e<s.length;e++)if(e<s.length-1){const t=s[e],i=s[e+1];n.push([t,i])}}}return n}function a(e,t,i,s,a,l){const o=[];let r=w(i/2),d=w(s/2);r+=l.getOffset(.05*-r,.05*r,a),d+=l.getOffset(.05*-d,.05*d,a);const f=a.hachureAngle;let h=a.hachureGap;0>=h&&(h=4*a.strokeWidth);let g=a.fillWeight;0>g&&(g=a.strokeWidth/2);const c=p(f%180*(b/180)),u=d/r,_=y(u*c*u*c+1),x=u*c/_,m=1/_,O=h/(r*d/y(d*m*(d*m)+r*x*(r*x))/r);let P=y(r*r-(e-r+O)*(e-r+O));for(let p=e-r+O;p<e+r;p+=O){P=y(r*r-(e-p)*(e-p));const i=n(p,t-P,e,t,x,m,u),s=n(p,t+P,e,t,x,m,u);o.push([i,s])}return o}function l(e,t){let i=t.fillStyle||'hachure';if(!z[i])switch(i){case'zigzag':z[i]||(z[i]=new C(e));break;case'cross-hatch':z[i]||(z[i]=new W(e));break;case'dots':z[i]||(z[i]=new N(e));break;case'hachure':default:i='hachure',z[i]||(z[i]=new T(e));}return z[i]}function o(e){if(L&&D&&self&&self.workly&&e.async&&!e.noWorker){const t=e.worklyURL||'https://cdn.jsdelivr.net/gh/pshihn/workly/dist/workly.min.js';if(t){const e=`importScripts('${t}', '${D}');\nworkly.expose(self.rough.createRenderer());`,i=URL.createObjectURL(new Blob([e]));return self.workly.proxy(i)}}return new E}var r=Math.round,p=Math.tan,d=Math.max,f=Math.min,h=Number.MAX_VALUE,g=Math.pow,c=Math.floor,u=Math.ceil,y=Math.sqrt,_=Math.cos,m=Math.sin,w=Math.abs,b=Math.PI;const x={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:4,t:2,V:1,v:1,Z:0,z:0};class O{constructor(e){this.COMMAND=0,this.NUMBER=1,this.EOD=2,this.segments=[],this.parseData(e),this.processPoints()}tokenize(e){const t=[];for(;''!==e;)if(e.match(/^([ \t\r\n,]+)/))e=e.substr(RegExp.$1.length);else if(e.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:this.COMMAND,text:RegExp.$1},e=e.substr(RegExp.$1.length);else if(e.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:this.NUMBER,text:`${parseFloat(RegExp.$1)}`},e=e.substr(RegExp.$1.length);else return console.error('Unrecognized segment command: '+e),[];return t[t.length]={type:this.EOD,text:''},t}parseData(t){const n=this.tokenize(t);let s=0,i=n[s],a='BOD';for(this.segments=[];!e(i,this.EOD);){let l;const o=[];if(!('BOD'===a))e(i,this.NUMBER)?l=x[a]:(s++,l=x[i.text],a=i.text);else if('M'===i.text||'m'===i.text)s++,l=x[i.text],a=i.text;else return void this.parseData('M0,0'+t);if(s+l<n.length){for(let t=s;t<s+l;t++){const i=n[t];if(e(i,this.NUMBER))o[o.length]=+i.text;else return void console.error('Parameter type is not a number: '+a+','+i.text)}if('number'==typeof x[a]){const e={key:a,data:o};this.segments.push(e),s+=l,i=n[s],'M'===a&&(a='L'),'m'===a&&(a='l')}else return void console.error('Unsupported segment type: '+a)}else console.error('Path data ended before all parameters were found')}}get closed(){if('undefined'==typeof this._closed){this._closed=!1;for(const e of this.segments)'z'===e.key.toLowerCase()&&(this._closed=!0)}return this._closed}processPoints(){let e=null,t=[0,0];for(let n=0;n<this.segments.length;n++){const i=this.segments[n];switch(i.key){case'M':case'L':case'T':i.point=[i.data[0],i.data[1]];break;case'm':case'l':case't':i.point=[i.data[0]+t[0],i.data[1]+t[1]];break;case'H':i.point=[i.data[0],t[1]];break;case'h':i.point=[i.data[0]+t[0],t[1]];break;case'V':i.point=[t[0],i.data[0]];break;case'v':i.point=[t[0],i.data[0]+t[1]];break;case'z':case'Z':e&&(i.point=[e[0],e[1]]);break;case'C':i.point=[i.data[4],i.data[5]];break;case'c':i.point=[i.data[4]+t[0],i.data[5]+t[1]];break;case'S':i.point=[i.data[2],i.data[3]];break;case's':i.point=[i.data[2]+t[0],i.data[3]+t[1]];break;case'Q':i.point=[i.data[2],i.data[3]];break;case'q':i.point=[i.data[2]+t[0],i.data[3]+t[1]];break;case'A':i.point=[i.data[5],i.data[6]];break;case'a':i.point=[i.data[5]+t[0],i.data[6]+t[1]];}('m'===i.key||'M'===i.key)&&(e=null),i.point&&(t=i.point,!e&&(e=i.point)),('z'===i.key||'Z'===i.key)&&(e=null)}}}class P{constructor(e){this._position=[0,0],this._first=null,this.bezierReflectionPoint=null,this.quadReflectionPoint=null,this.parsed=new O(e)}get segments(){return this.parsed.segments}get closed(){return this.parsed.closed}get linearPoints(){if(!this._linearPoints){const e=[];let t=[];for(const i of this.parsed.segments){const n=i.key.toLowerCase();('m'===n||'z'===n)&&(t.length&&(e.push(t),t=[]),'z'===n)||i.point&&t.push(i.point)}t.length&&(e.push(t),t=[]),this._linearPoints=e}return this._linearPoints}get first(){return this._first}set first(e){this._first=e}setPosition(e,t){this._position=[e,t],this._first||(this._first=[e,t])}get position(){return this._position}get x(){return this._position[0]}get y(){return this._position[1]}}class v{constructor(e,t,i,n,s,a){if(this._segIndex=0,this._numSegs=0,this._rx=0,this._ry=0,this._sinPhi=0,this._cosPhi=0,this._C=[0,0],this._theta=0,this._delta=0,this._T=0,this._from=e,e[0]===t[0]&&e[1]===t[1])return;const l=b/180;this._rx=w(i[0]),this._ry=w(i[1]),this._sinPhi=m(n*l),this._cosPhi=_(n*l);const o=this._cosPhi*(e[0]-t[0])/2+this._sinPhi*(e[1]-t[1])/2,r=-this._sinPhi*(e[0]-t[0])/2+this._cosPhi*(e[1]-t[1])/2;let p=0;const d=this._rx*this._rx*this._ry*this._ry-this._rx*this._rx*r*r-this._ry*this._ry*o*o;if(0>d){const e=y(1-d/(this._rx*this._rx*this._ry*this._ry));this._rx*=e,this._ry*=e,p=0}else p=(s===a?-1:1)*y(d/(this._rx*this._rx*r*r+this._ry*this._ry*o*o));const f=p*this._rx*r/this._ry,h=-p*this._ry*o/this._rx;this._C=[0,0],this._C[0]=this._cosPhi*f-this._sinPhi*h+(e[0]+t[0])/2,this._C[1]=this._sinPhi*f+this._cosPhi*h+(e[1]+t[1])/2,this._theta=this.calculateVectorAngle(1,0,(o-f)/this._rx,(r-h)/this._ry);let g=this.calculateVectorAngle((o-f)/this._rx,(r-h)/this._ry,(-o-f)/this._rx,(-r-h)/this._ry);!a&&0<g?g-=2*b:a&&0>g&&(g+=2*b),this._numSegs=u(w(g/(b/2))),this._delta=g/this._numSegs,this._T=8/3*m(this._delta/4)*m(this._delta/4)/m(this._delta/2)}getNextSegment(){if(this._segIndex===this._numSegs)return null;const e=_(this._theta),t=m(this._theta),i=this._theta+this._delta,n=_(i),s=m(i),a=[this._cosPhi*this._rx*n-this._sinPhi*this._ry*s+this._C[0],this._sinPhi*this._rx*n+this._cosPhi*this._ry*s+this._C[1]],l=[this._from[0]+this._T*(-this._cosPhi*this._rx*t-this._sinPhi*this._ry*e),this._from[1]+this._T*(-this._sinPhi*this._rx*t+this._cosPhi*this._ry*e)],o=[a[0]+this._T*(this._cosPhi*this._rx*s+this._sinPhi*this._ry*n),a[1]+this._T*(this._sinPhi*this._rx*s-this._cosPhi*this._ry*n)];return this._theta=i,this._from=[a[0],a[1]],this._segIndex++,{cp1:l,cp2:o,to:a}}calculateVectorAngle(e,t,i,n){var s=Math.atan2;const a=s(t,e),l=s(n,i);return l>=a?l-a:2*b-(a-l)}}class k{constructor(e,t){this.sets=e,this.closed=t}fit(e){const t=[];for(const i of this.sets){const n=i.length;let s=c(e*n);if(5>s){if(5>=n)continue;s=5}t.push(this.reduce(i,s))}let n='';for(const s of t){for(let e=0;e<s.length;e++){const t=s[e];n+=0===e?'M'+t[0]+','+t[1]:'L'+t[0]+','+t[1]}this.closed&&(n+='z ')}return n}distance(e,t){return y(g(e[0]-t[0],2)+g(e[1]-t[1],2))}reduce(e,t){if(e.length<=t)return e;const n=e.slice(0);for(;n.length>t;){let e=-1,t=-1;for(let l=1;l<n.length-1;l++){const i=this.distance(n[l-1],n[l]),a=this.distance(n[l],n[l+1]),o=this.distance(n[l-1],n[l+1]),r=(i+a+o)/2,s=y(r*(r-i)*(r-a)*(r-o));(0>e||s<e)&&(e=s,t=l)}if(0<t)n.splice(t,1);else break}return n}}class A{constructor(e,t){this.xi=h,this.yi=h,this.px1=e[0],this.py1=e[1],this.px2=t[0],this.py2=t[1],this.a=this.py2-this.py1,this.b=this.px1-this.px2,this.c=this.px2*this.py1-this.px1*this.py2,this._undefined=0===this.a&&0===this.b&&0===this.c}isUndefined(){return this._undefined}intersects(e){if(this.isUndefined()||e.isUndefined())return!1;let t=h,i=h,n=0,s=0;const l=this.a,a=this.b,o=this.c;return(1e-5<w(a)&&(t=-l/a,n=-o/a),1e-5<w(e.b)&&(i=-e.a/e.b,s=-e.c/e.b),t===h)?i===h?-o/l==-e.c/e.a&&(this.py1>=f(e.py1,e.py2)&&this.py1<=d(e.py1,e.py2)?(this.xi=this.px1,this.yi=this.py1,!0):!!(this.py2>=f(e.py1,e.py2)&&this.py2<=d(e.py1,e.py2))&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=this.px1,this.yi=i*this.xi+s,!(-1e-5>(this.py1-this.yi)*(this.yi-this.py2)||-1e-5>(e.py1-this.yi)*(this.yi-e.py2))&&(!(1e-5>w(e.a))||!(-1e-5>(e.px1-this.xi)*(this.xi-e.px2)))):i===h?(this.xi=e.px1,this.yi=t*this.xi+n,!(-1e-5>(e.py1-this.yi)*(this.yi-e.py2)||-1e-5>(this.py1-this.yi)*(this.yi-this.py2))&&(!(1e-5>w(l))||!(-1e-5>(this.px1-this.xi)*(this.xi-this.px2)))):t===i?n==s&&(this.px1>=f(e.px1,e.px2)&&this.px1<=d(e.py1,e.py2)?(this.xi=this.px1,this.yi=this.py1,!0):!!(this.px2>=f(e.px1,e.px2)&&this.px2<=d(e.px1,e.px2))&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=(s-n)/(t-i),this.yi=t*this.xi+n,!(-1e-5>(this.px1-this.xi)*(this.xi-this.px2)||-1e-5>(e.px1-this.xi)*(this.xi-e.px2)))}}class S{constructor(e,t,i,n,s,a,l,o){this.deltaX=0,this.hGap=0,this.top=e,this.bottom=t,this.left=i,this.right=n,this.gap=s,this.sinAngle=a,this.tanAngle=o,1e-4>w(a)?this.pos=i+s:.9999<w(a)?this.pos=e+s:(this.deltaX=(t-e)*w(o),this.pos=i-w(this.deltaX),this.hGap=w(s/l),this.sLeft=new A([i,t],[i,e]),this.sRight=new A([n,t],[n,e]))}nextLine(){if(1e-4>w(this.sinAngle)){if(this.pos<this.right){const e=[this.pos,this.top,this.pos,this.bottom];return this.pos+=this.gap,e}}else if(!(.9999<w(this.sinAngle))){let e=this.pos-this.deltaX/2,t=this.pos+this.deltaX/2,i=this.bottom,n=this.top;if(this.pos<this.right+this.deltaX){for(;e<this.left&&t<this.left||e>this.right&&t>this.right;)if(this.pos+=this.hGap,e=this.pos-this.deltaX/2,t=this.pos+this.deltaX/2,this.pos>this.right+this.deltaX)return null;const a=new A([e,i],[t,n]);this.sLeft&&a.intersects(this.sLeft)&&(e=a.xi,i=a.yi),this.sRight&&a.intersects(this.sRight)&&(t=a.xi,n=a.yi),0<this.tanAngle&&(e=this.right-(e-this.left),t=this.right-(t-this.left));const s=[e,i,t,n];return this.pos+=this.hGap,s}}else if(this.pos<this.bottom){const e=[this.left,this.pos,this.right,this.pos];return this.pos+=this.gap,e}return null}}class T{constructor(e){this.renderer=e}fillPolygon(e,t){return this._fillPolygon(e,t)}fillEllipse(e,t,i,n,s){return this._fillEllipse(e,t,i,n,s)}_fillPolygon(e,t,i=!1){const n=s(e,t),a=this.renderLines(n,t,i);return{type:'fillSketch',ops:a}}_fillEllipse(e,t,i,n,s,l=!1){const o=a(e,t,i,n,s,this.renderer),r=this.renderLines(o,s,l);return{type:'fillSketch',ops:r}}renderLines(e,t,i){let n=[],s=null;for(const a of e)n=n.concat(this.renderer.doubleLine(a[0][0],a[0][1],a[1][0],a[1][1],t)),i&&s&&(n=n.concat(this.renderer.doubleLine(s[0],s[1],a[0][0],a[0][1],t))),s=a[1];return n}}class C extends T{fillPolygon(e,t){return this._fillPolygon(e,t,!0)}fillEllipse(e,t,i,n,s){return this._fillEllipse(e,t,i,n,s,!0)}}class W extends T{fillPolygon(e,t){const i=this._fillPolygon(e,t),n=Object.assign({},t,{hachureAngle:t.hachureAngle+90}),s=this._fillPolygon(e,n);return i.ops=i.ops.concat(s.ops),i}fillEllipse(e,t,i,n,s){const a=this._fillEllipse(e,t,i,n,s),l=Object.assign({},s,{hachureAngle:s.hachureAngle+90}),o=this._fillEllipse(e,t,i,n,l);return a.ops=a.ops.concat(o.ops),a}}class N{constructor(e){this.renderer=e}fillPolygon(e,t){t=Object.assign({},t,{curveStepCount:4,hachureAngle:0});const i=s(e,t);return this.dotsOnLines(i,t)}fillEllipse(e,t,i,n,s){s=Object.assign({},s,{curveStepCount:4,hachureAngle:0});const l=a(e,t,i,n,s,this.renderer);return this.dotsOnLines(l,s)}dotsOnLines(e,n){let s=[],a=n.hachureGap;0>a&&(a=4*n.strokeWidth),a=d(a,.1);let o=n.fillWeight;0>o&&(o=n.strokeWidth/2);for(const r of e){const e=t(r),i=e/a,l=u(i)-1,p=Math.atan((r[1][1]-r[0][1])/(r[1][0]-r[0][0]));for(let e=0;e<l;e++){const t=a*(e+1),i=t*m(p),l=t*_(p),d=[r[0][0]-l,r[0][1]+i],f=this.renderer.getOffset(d[0]-a/4,d[0]+a/4,n),h=this.renderer.getOffset(d[1]-a/4,d[1]+a/4,n),g=this.renderer.ellipse(f,h,o,o,n);s=s.concat(g.ops)}}return{type:'fillSketch',ops:s}}}const z={};class E{line(e,t,i,n,s){const a=this.doubleLine(e,t,i,n,s);return{type:'path',ops:a}}linearPath(e,t,n){const s=(e||[]).length;if(2<s){let a=[];for(let t=0;t<s-1;t++)a=a.concat(this.doubleLine(e[t][0],e[t][1],e[t+1][0],e[t+1][1],n));return t&&(a=a.concat(this.doubleLine(e[s-1][0],e[s-1][1],e[0][0],e[0][1],n))),{type:'path',ops:a}}return 2===s?this.line(e[0][0],e[0][1],e[1][0],e[1][1],n):{type:'path',ops:[]}}polygon(e,t){return this.linearPath(e,!0,t)}rectangle(e,t,i,n,s){return this.polygon([[e,t],[e+i,t],[e+i,t+n],[e,t+n]],s)}curve(e,t){const i=this._curveWithOffset(e,1*(1+.2*t.roughness),t),n=this._curveWithOffset(e,1.5*(1+.22*t.roughness),t);return{type:'path',ops:i.concat(n)}}ellipse(e,t,i,n,s){const a=2*b/s.curveStepCount;let l=w(i/2),o=w(n/2);l+=this.getOffset(.05*-l,.05*l,s),o+=this.getOffset(.05*-o,.05*o,s);const r=this._ellipse(a,e,t,l,o,1,a*this.getOffset(.1,this.getOffset(.4,1,s),s),s),p=this._ellipse(a,e,t,l,o,1.5,0,s);return{type:'path',ops:r.concat(p)}}arc(e,t,i,n,s,a,l,r,p){const o=e,d=t;let h=w(i/2),g=w(n/2);h+=this.getOffset(.01*-h,.01*h,p),g+=this.getOffset(.01*-g,.01*g,p);let c=s,u=a;for(;0>c;)c+=2*b,u+=2*b;u-c>2*b&&(c=0,u=2*b);const y=2*b/p.curveStepCount,x=f(y/2,(u-c)/2),O=this._arc(x,o,d,h,g,c,u,1,p),P=this._arc(x,o,d,h,g,c,u,1.5,p);let v=O.concat(P);return l&&(r?(v=v.concat(this.doubleLine(o,d,o+h*_(c),d+g*m(c),p)),v=v.concat(this.doubleLine(o,d,o+h*_(u),d+g*m(u),p))):(v.push({op:'lineTo',data:[o,d]}),v.push({op:'lineTo',data:[o+h*_(c),d+g*m(c)]}))),{type:'path',ops:v}}svgPath(e,t){e=(e||'').replace(/\n/g,' ').replace(/(-\s)/g,'-').replace('/(ss)/g',' ');let n=new P(e);if(t.simplification){const e=new k(n.linearPoints,n.closed),i=e.fit(t.simplification);n=new P(i)}let a=[];const l=n.segments||[];for(let o=0;o<l.length;o++){const e=l[o],i=0<o?l[o-1]:null,s=this._processSegment(n,e,i,t);s&&s.length&&(a=a.concat(s))}return{type:'path',ops:a}}solidFillPolygon(e,t){const n=[];if(e.length){const s=t.maxRandomnessOffset||0,a=e.length;if(2<a){n.push({op:'move',data:[e[0][0]+this.getOffset(-s,s,t),e[0][1]+this.getOffset(-s,s,t)]});for(let l=1;l<a;l++)n.push({op:'lineTo',data:[e[l][0]+this.getOffset(-s,s,t),e[l][1]+this.getOffset(-s,s,t)]})}}return{type:'fillPath',ops:n}}patternFillPolygon(e,t){const i=l(this,t);return i.fillPolygon(e,t)}patternFillEllipse(e,t,i,n,s){const a=l(this,s);return a.fillEllipse(e,t,i,n,s)}patternFillArc(e,t,i,n,s,a,l){const o=e,r=t;let p=w(i/2),d=w(n/2);p+=this.getOffset(.01*-p,.01*p,l),d+=this.getOffset(.01*-d,.01*d,l);let f=s,h=a;for(;0>f;)f+=2*b,h+=2*b;h-f>2*b&&(f=0,h=2*b);const g=(h-f)/l.curveStepCount,c=[];for(let u=f;u<=h;u+=g)c.push([o+p*_(u),r+d*m(u)]);return c.push([o+p*_(h),r+d*m(h)]),c.push([o,r]),this.patternFillPolygon(c,l)}getOffset(e,t,i){return i.roughness*(Math.random()*(t-e)+e)}doubleLine(e,t,i,n,s){const a=this._line(e,t,i,n,s,!0,!1),l=this._line(e,t,i,n,s,!0,!0);return a.concat(l)}_line(e,t,i,n,s,a,l){const o=g(e-i,2)+g(t-n,2);let r=s.maxRandomnessOffset||0;100*(r*r)>o&&(r=y(o)/10);const p=r/2,d=.2+.2*Math.random();let f=s.bowing*s.maxRandomnessOffset*(n-t)/200,h=s.bowing*s.maxRandomnessOffset*(e-i)/200;f=this.getOffset(-f,f,s),h=this.getOffset(-h,h,s);const c=[];return a&&(l?c.push({op:'move',data:[e+this.getOffset(-p,p,s),t+this.getOffset(-p,p,s)]}):c.push({op:'move',data:[e+this.getOffset(-r,r,s),t+this.getOffset(-r,r,s)]})),l?c.push({op:'bcurveTo',data:[f+e+(i-e)*d+this.getOffset(-p,p,s),h+t+(n-t)*d+this.getOffset(-p,p,s),f+e+2*(i-e)*d+this.getOffset(-p,p,s),h+t+2*(n-t)*d+this.getOffset(-p,p,s),i+this.getOffset(-p,p,s),n+this.getOffset(-p,p,s)]}):c.push({op:'bcurveTo',data:[f+e+(i-e)*d+this.getOffset(-r,r,s),h+t+(n-t)*d+this.getOffset(-r,r,s),f+e+2*(i-e)*d+this.getOffset(-r,r,s),h+t+2*(n-t)*d+this.getOffset(-r,r,s),i+this.getOffset(-r,r,s),n+this.getOffset(-r,r,s)]}),c}_curve(e,t,i){const n=e.length;let a=[];if(3<n){const l=[],o=1-i.curveTightness;a.push({op:'move',data:[e[1][0],e[1][1]]});for(let t=1;t+2<n;t++){const i=e[t];l[0]=[i[0],i[1]],l[1]=[i[0]+(o*e[t+1][0]-o*e[t-1][0])/6,i[1]+(o*e[t+1][1]-o*e[t-1][1])/6],l[2]=[e[t+1][0]+(o*e[t][0]-o*e[t+2][0])/6,e[t+1][1]+(o*e[t][1]-o*e[t+2][1])/6],l[3]=[e[t+1][0],e[t+1][1]],a.push({op:'bcurveTo',data:[l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1]]})}if(t&&2===t.length){const e=i.maxRandomnessOffset;a.push({op:'lineTo',data:[t[0]+this.getOffset(-e,e,i),t[1]+ +this.getOffset(-e,e,i)]})}}else 3===n?(a.push({op:'move',data:[e[1][0],e[1][1]]}),a.push({op:'bcurveTo',data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):2===n&&(a=a.concat(this.doubleLine(e[0][0],e[0][1],e[1][0],e[1][1],i)));return a}_ellipse(e,t,i,n,s,a,l,r){const o=this.getOffset(-.5,.5,r)-b/2,p=[];p.push([this.getOffset(-a,a,r)+t+.9*n*_(o-e),this.getOffset(-a,a,r)+i+.9*s*m(o-e)]);for(let d=o;d<2*b+o-.01;d+=e)p.push([this.getOffset(-a,a,r)+t+n*_(d),this.getOffset(-a,a,r)+i+s*m(d)]);return p.push([this.getOffset(-a,a,r)+t+n*_(o+2*b+.5*l),this.getOffset(-a,a,r)+i+s*m(o+2*b+.5*l)]),p.push([this.getOffset(-a,a,r)+t+.98*n*_(o+l),this.getOffset(-a,a,r)+i+.98*s*m(o+l)]),p.push([this.getOffset(-a,a,r)+t+.9*n*_(o+.5*l),this.getOffset(-a,a,r)+i+.9*s*m(o+.5*l)]),this._curve(p,null,r)}_curveWithOffset(e,t,n){const s=[[e[0][0]+this.getOffset(-t,t,n),e[0][1]+this.getOffset(-t,t,n)],[e[0][0]+this.getOffset(-t,t,n),e[0][1]+this.getOffset(-t,t,n)]];for(let a=1;a<e.length;a++)s.push([e[a][0]+this.getOffset(-t,t,n),e[a][1]+this.getOffset(-t,t,n)]),a===e.length-1&&s.push([e[a][0]+this.getOffset(-t,t,n),e[a][1]+this.getOffset(-t,t,n)]);return this._curve(s,null,n)}_arc(e,t,i,n,s,a,l,r,p){const o=a+this.getOffset(-.1,.1,p),d=[];d.push([this.getOffset(-r,r,p)+t+.9*n*_(o-e),this.getOffset(-r,r,p)+i+.9*s*m(o-e)]);for(let f=o;f<=l;f+=e)d.push([this.getOffset(-r,r,p)+t+n*_(f),this.getOffset(-r,r,p)+i+s*m(f)]);return d.push([t+n*_(l),i+s*m(l)]),d.push([t+n*_(l),i+s*m(l)]),this._curve(d,null,p)}_bezierTo(e,t,n,s,a,l,r,p){const o=[],d=[p.maxRandomnessOffset||1,(p.maxRandomnessOffset||1)+.5];let h=[0,0];for(let f=0;2>f;f++)0===f?o.push({op:'move',data:[r.x,r.y]}):o.push({op:'move',data:[r.x+this.getOffset(-d[0],d[0],p),r.y+this.getOffset(-d[0],d[0],p)]}),h=[a+this.getOffset(-d[f],d[f],p),l+this.getOffset(-d[f],d[f],p)],o.push({op:'bcurveTo',data:[e+this.getOffset(-d[f],d[f],p),t+this.getOffset(-d[f],d[f],p),n+this.getOffset(-d[f],d[f],p),s+this.getOffset(-d[f],d[f],p),h[0],h[1]]});return r.setPosition(h[0],h[1]),o}_processSegment(e,t,i,n){let s=[];switch(t.key){case'M':case'm':{const i='m'===t.key;if(2<=t.data.length){let a=+t.data[0],l=+t.data[1];i&&(a+=e.x,l+=e.y);const o=1*(n.maxRandomnessOffset||0);a+=this.getOffset(-o,o,n),l+=this.getOffset(-o,o,n),e.setPosition(a,l),s.push({op:'move',data:[a,l]})}break}case'L':case'l':{const i='l'===t.key;if(2<=t.data.length){let a=+t.data[0],l=+t.data[1];i&&(a+=e.x,l+=e.y),s=s.concat(this.doubleLine(e.x,e.y,a,l,n)),e.setPosition(a,l)}break}case'H':case'h':{const i='h'===t.key;if(t.data.length){let a=+t.data[0];i&&(a+=e.x),s=s.concat(this.doubleLine(e.x,e.y,a,e.y,n)),e.setPosition(a,e.y)}break}case'V':case'v':{const i='v'===t.key;if(t.data.length){let a=+t.data[0];i&&(a+=e.y),s=s.concat(this.doubleLine(e.x,e.y,e.x,a,n)),e.setPosition(e.x,a)}break}case'Z':case'z':{e.first&&(s=s.concat(this.doubleLine(e.x,e.y,e.first[0],e.first[1],n)),e.setPosition(e.first[0],e.first[1]),e.first=null);break}case'C':case'c':{const i='c'===t.key;if(6<=t.data.length){let a=+t.data[0],l=+t.data[1],o=+t.data[2],r=+t.data[3],p=+t.data[4],d=+t.data[5];i&&(a+=e.x,o+=e.x,p+=e.x,l+=e.y,r+=e.y,d+=e.y);const f=this._bezierTo(a,l,o,r,p,d,e,n);s=s.concat(f),e.bezierReflectionPoint=[p+(p-o),d+(d-r)]}break}case'S':case's':{const a='s'===t.key;if(4<=t.data.length){let l=+t.data[0],o=+t.data[1],r=+t.data[2],p=+t.data[3];a&&(l+=e.x,r+=e.x,o+=e.y,p+=e.y);let d=l,f=o;const h=i?i.key:'';let g=null;('c'===h||'C'===h||'s'===h||'S'===h)&&(g=e.bezierReflectionPoint),g&&(d=g[0],f=g[1]);const c=this._bezierTo(d,f,l,o,r,p,e,n);s=s.concat(c),e.bezierReflectionPoint=[r+(r-l),p+(p-o)]}break}case'Q':case'q':{const i='q'===t.key;if(4<=t.data.length){let a=+t.data[0],l=+t.data[1],o=+t.data[2],r=+t.data[3];i&&(a+=e.x,o+=e.x,l+=e.y,r+=e.y);const p=1*(1+.2*n.roughness),d=1.5*(1+.22*n.roughness);s.push({op:'move',data:[e.x+this.getOffset(-p,p,n),e.y+this.getOffset(-p,p,n)]});let h=[o+this.getOffset(-p,p,n),r+this.getOffset(-p,p,n)];s.push({op:'qcurveTo',data:[a+this.getOffset(-p,p,n),l+this.getOffset(-p,p,n),h[0],h[1]]}),s.push({op:'move',data:[e.x+this.getOffset(-d,d,n),e.y+this.getOffset(-d,d,n)]}),h=[o+this.getOffset(-d,d,n),r+this.getOffset(-d,d,n)],s.push({op:'qcurveTo',data:[a+this.getOffset(-d,d,n),l+this.getOffset(-d,d,n),h[0],h[1]]}),e.setPosition(h[0],h[1]),e.quadReflectionPoint=[o+(o-a),r+(r-l)]}break}case'T':case't':{const a='t'===t.key;if(2<=t.data.length){let l=+t.data[0],o=+t.data[1];a&&(l+=e.x,o+=e.y);let r=l,p=o;const d=i?i.key:'';let h=null;('q'===d||'Q'===d||'t'===d||'T'===d)&&(h=e.quadReflectionPoint),h&&(r=h[0],p=h[1]);const g=1*(1+.2*n.roughness),c=1.5*(1+.22*n.roughness);s.push({op:'move',data:[e.x+this.getOffset(-g,g,n),e.y+this.getOffset(-g,g,n)]});let u=[l+this.getOffset(-g,g,n),o+this.getOffset(-g,g,n)];s.push({op:'qcurveTo',data:[r+this.getOffset(-g,g,n),p+this.getOffset(-g,g,n),u[0],u[1]]}),s.push({op:'move',data:[e.x+this.getOffset(-c,c,n),e.y+this.getOffset(-c,c,n)]}),u=[l+this.getOffset(-c,c,n),o+this.getOffset(-c,c,n)],s.push({op:'qcurveTo',data:[r+this.getOffset(-c,c,n),p+this.getOffset(-c,c,n),u[0],u[1]]}),e.setPosition(u[0],u[1]),e.quadReflectionPoint=[l+(l-r),o+(o-p)]}break}case'A':case'a':{const i='a'===t.key;if(7<=t.data.length){const a=+t.data[0],l=+t.data[1],o=+t.data[2],r=+t.data[3],p=+t.data[4];let d=+t.data[5],f=+t.data[6];if(i&&(d+=e.x,f+=e.y),d===e.x&&f===e.y)break;if(0==a||0==l)s=s.concat(this.doubleLine(e.x,e.y,d,f,n)),e.setPosition(d,f);else for(let t=0;1>t;t++){const t=new v([e.x,e.y],[d,f],[a,l],o,!!r,!!p);for(let i=t.getNextSegment();i;){const a=this._bezierTo(i.cp1[0],i.cp1[1],i.cp2[0],i.cp2[1],i.to[0],i.to[1],e,n);s=s.concat(a),i=t.getNextSegment()}}}break}default:}return s}}const L='undefined'!=typeof self,D=L&&self&&self.document&&self.document.currentScript&&self.document.currentScript.src,R='undefined'!=typeof self;class B{constructor(e,t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:'#000',strokeWidth:1,curveTightness:0,curveStepCount:9,fillStyle:'hachure',fillWeight:-1,hachureAngle:-41,hachureGap:-1},this.config=e||{},this.surface=t,this.renderer=o(this.config),this.config.options&&(this.defaultOptions=this._options(this.config.options))}_options(e){return e?Object.assign({},this.defaultOptions,e):this.defaultOptions}_drawable(e,t,i){return{shape:e,sets:t||[],options:i||this.defaultOptions}}get lib(){return this.renderer}getCanvasSize(){const e=e=>e&&'object'==typeof e&&e.baseVal&&e.baseVal.value?e.baseVal.value:e||100;return this.surface?[e(this.surface.width),e(this.surface.height)]:[100,100]}computePolygonSize(e){if(e.length){let t=e[0][0],n=e[0][0],s=e[0][1],a=e[0][1];for(let l=1;l<e.length;l++)t=f(t,e[l][0]),n=d(n,e[l][0]),s=f(s,e[l][1]),a=d(a,e[l][1]);return[n-t,a-s]}return[0,0]}polygonPath(e){let t='';if(e.length){t=`M${e[0][0]},${e[0][1]}`;for(let n=1;n<e.length;n++)t=`${t} L${e[n][0]},${e[n][1]}`}return t}computePathSize(e){let t=[0,0];if(R&&self.document)try{const i=self.document.createElementNS('http://www.w3.org/2000/svg','svg');i.setAttribute('width','0'),i.setAttribute('height','0');const n=self.document.createElementNS('http://www.w3.org/2000/svg','path');n.setAttribute('d',e),i.appendChild(n),self.document.body.appendChild(i);const s=n.getBBox();s&&(t[0]=s.width||0,t[1]=s.height||0),self.document.body.removeChild(i)}catch(e){}const i=this.getCanvasSize();return t[0]*t[1]||(t=i),t}toPaths(e){const t=e.sets||[],i=e.options||this.defaultOptions,n=[];for(const s of t){let e=null;switch(s.type){case'path':e={d:this.opsToPath(s),stroke:i.stroke,strokeWidth:i.strokeWidth,fill:'none'};break;case'fillPath':e={d:this.opsToPath(s),stroke:'none',strokeWidth:0,fill:i.fill||'none'};break;case'fillSketch':e=this.fillSketch(s,i);break;case'path2Dfill':e={d:s.path||'',stroke:'none',strokeWidth:0,fill:i.fill||'none'};break;case'path2Dpattern':{const t=s.size,n={x:0,y:0,width:1,height:1,viewBox:`0 0 ${r(t[0])} ${r(t[1])}`,patternUnits:'objectBoundingBox',path:this.fillSketch(s,i)};e={d:s.path,stroke:'none',strokeWidth:0,pattern:n};break}}e&&n.push(e)}return n}fillSketch(e,t){let i=t.fillWeight;return 0>i&&(i=t.strokeWidth/2),{d:this.opsToPath(e),stroke:t.fill||'none',strokeWidth:i,fill:'none'}}opsToPath(e){let t='';for(const i of e.ops){const e=i.data;switch(i.op){case'move':t+=`M${e[0]} ${e[1]} `;break;case'bcurveTo':t+=`C${e[0]} ${e[1]}, ${e[2]} ${e[3]}, ${e[4]} ${e[5]} `;break;case'qcurveTo':t+=`Q${e[0]} ${e[1]}, ${e[2]} ${e[3]} `;break;case'lineTo':t+=`L${e[0]} ${e[1]} `;}}return t.trim()}}class M extends B{constructor(e,t){super(e,t)}line(e,t,i,n,s){const a=this._options(s);return this._drawable('line',[this.lib.line(e,t,i,n,a)],a)}rectangle(e,t,i,n,s){const a=this._options(s),l=[];if(a.fill){const s=[[e,t],[e+i,t],[e+i,t+n],[e,t+n]];'solid'===a.fillStyle?l.push(this.lib.solidFillPolygon(s,a)):l.push(this.lib.patternFillPolygon(s,a))}return l.push(this.lib.rectangle(e,t,i,n,a)),this._drawable('rectangle',l,a)}ellipse(e,t,i,n,s){const a=this._options(s),l=[];if(a.fill)if('solid'===a.fillStyle){const s=this.lib.ellipse(e,t,i,n,a);s.type='fillPath',l.push(s)}else l.push(this.lib.patternFillEllipse(e,t,i,n,a));return l.push(this.lib.ellipse(e,t,i,n,a)),this._drawable('ellipse',l,a)}circle(e,t,i,n){const s=this.ellipse(e,t,i,i,n);return s.shape='circle',s}linearPath(e,t){const i=this._options(t);return this._drawable('linearPath',[this.lib.linearPath(e,!1,i)],i)}arc(e,t,i,n,s,a,l=!1,r){const p=this._options(r),o=[];if(l&&p.fill)if('solid'===p.fillStyle){const l=this.lib.arc(e,t,i,n,s,a,!0,!1,p);l.type='fillPath',o.push(l)}else o.push(this.lib.patternFillArc(e,t,i,n,s,a,p));return o.push(this.lib.arc(e,t,i,n,s,a,l,!0,p)),this._drawable('arc',o,p)}curve(e,t){const i=this._options(t);return this._drawable('curve',[this.lib.curve(e,i)],i)}polygon(e,t){const i=this._options(t),n=[];if(i.fill)if('solid'===i.fillStyle)n.push(this.lib.solidFillPolygon(e,i));else{const t=this.computePolygonSize(e),s=[[0,0],[t[0],0],[t[0],t[1]],[0,t[1]]],a=this.lib.patternFillPolygon(s,i);a.type='path2Dpattern',a.size=t,a.path=this.polygonPath(e),n.push(a)}return n.push(this.lib.linearPath(e,!0,i)),this._drawable('polygon',n,i)}path(e,t){const i=this._options(t),n=[];if(!e)return this._drawable('path',n,i);if(i.fill)if('solid'===i.fillStyle){n.push({type:'path2Dfill',path:e,ops:[]})}else{const t=this.computePathSize(e),s=[[0,0],[t[0],0],[t[0],t[1]],[0,t[1]]],a=this.lib.patternFillPolygon(s,i);a.type='path2Dpattern',a.size=t,a.path=e,n.push(a)}return n.push(this.lib.svgPath(e,i)),this._drawable('path',n,i)}}const q='undefined'!=typeof document;class F{constructor(e){this.canvas=e,this.ctx=this.canvas.getContext('2d')}static createRenderer(){return new E}draw(e){const t=e.sets||[],i=e.options||this.getDefaultOptions(),n=this.ctx;for(const s of t)switch(s.type){case'path':n.save(),n.strokeStyle=i.stroke,n.lineWidth=i.strokeWidth,this._drawToContext(n,s),n.restore();break;case'fillPath':n.save(),n.fillStyle=i.fill||'',this._drawToContext(n,s),n.restore();break;case'fillSketch':this.fillSketch(n,s,i);break;case'path2Dfill':{this.ctx.save(),this.ctx.fillStyle=i.fill||'';const e=new Path2D(s.path);this.ctx.fill(e),this.ctx.restore();break}case'path2Dpattern':{const e=this.canvas.ownerDocument||q&&document;if(e){const t=s.size,n=e.createElement('canvas'),a=n.getContext('2d'),l=this.computeBBox(s.path);l&&(l.width||l.height)?(n.width=this.canvas.width,n.height=this.canvas.height,a.translate(l.x||0,l.y||0)):(n.width=t[0],n.height=t[1]),this.fillSketch(a,s,i),this.ctx.save(),this.ctx.fillStyle=this.ctx.createPattern(n,'repeat');const o=new Path2D(s.path);this.ctx.fill(o),this.ctx.restore()}else console.error('Cannot render path2Dpattern. No defs/document defined.');break}}}computeBBox(e){if(q)try{const t=document.createElementNS('http://www.w3.org/2000/svg','svg');t.setAttribute('width','0'),t.setAttribute('height','0');const i=self.document.createElementNS('http://www.w3.org/2000/svg','path');i.setAttribute('d',e),t.appendChild(i),document.body.appendChild(t);const n=i.getBBox();return document.body.removeChild(t),n}catch(e){}return null}fillSketch(e,t,i){let n=i.fillWeight;0>n&&(n=i.strokeWidth/2),e.save(),e.strokeStyle=i.fill||'',e.lineWidth=n,this._drawToContext(e,t),e.restore()}_drawToContext(e,t){e.beginPath();for(const i of t.ops){const t=i.data;switch(i.op){case'move':e.moveTo(t[0],t[1]);break;case'bcurveTo':e.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5]);break;case'qcurveTo':e.quadraticCurveTo(t[0],t[1],t[2],t[3]);break;case'lineTo':e.lineTo(t[0],t[1]);}}'fillPath'===t.type?e.fill():e.stroke()}}class U extends F{constructor(e,t){super(e),this.gen=new M(t||null,this.canvas)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(e,t,i,n,s){const a=this.gen.line(e,t,i,n,s);return this.draw(a),a}rectangle(e,t,i,n,s){const a=this.gen.rectangle(e,t,i,n,s);return this.draw(a),a}ellipse(e,t,i,n,s){const a=this.gen.ellipse(e,t,i,n,s);return this.draw(a),a}circle(e,t,i,n){const s=this.gen.circle(e,t,i,n);return this.draw(s),s}linearPath(e,t){const i=this.gen.linearPath(e,t);return this.draw(i),i}polygon(e,t){const i=this.gen.polygon(e,t);return this.draw(i),i}arc(e,t,i,n,s,a,l=!1,o){const r=this.gen.arc(e,t,i,n,s,a,l,o);return this.draw(r),r}curve(e,t){const i=this.gen.curve(e,t);return this.draw(i),i}path(e,t){const i=this.gen.path(e,t);return this.draw(i),i}}class X extends B{async line(e,t,i,n,s){const a=this._options(s);return this._drawable('line',[await this.lib.line(e,t,i,n,a)],a)}async rectangle(e,t,i,n,s){const a=this._options(s),l=[];if(a.fill){const s=[[e,t],[e+i,t],[e+i,t+n],[e,t+n]];'solid'===a.fillStyle?l.push((await this.lib.solidFillPolygon(s,a))):l.push((await this.lib.patternFillPolygon(s,a)))}return l.push((await this.lib.rectangle(e,t,i,n,a))),this._drawable('rectangle',l,a)}async ellipse(e,t,i,n,s){const a=this._options(s),l=[];if(a.fill)if('solid'===a.fillStyle){const s=await this.lib.ellipse(e,t,i,n,a);s.type='fillPath',l.push(s)}else l.push((await this.lib.patternFillEllipse(e,t,i,n,a)));return l.push((await this.lib.ellipse(e,t,i,n,a))),this._drawable('ellipse',l,a)}async circle(e,t,i,n){const s=await this.ellipse(e,t,i,i,n);return s.shape='circle',s}async linearPath(e,t){const i=this._options(t);return this._drawable('linearPath',[await this.lib.linearPath(e,!1,i)],i)}async arc(e,t,i,n,s,a,l=!1,r){const p=this._options(r),o=[];if(l&&p.fill)if('solid'===p.fillStyle){const l=await this.lib.arc(e,t,i,n,s,a,!0,!1,p);l.type='fillPath',o.push(l)}else o.push((await this.lib.patternFillArc(e,t,i,n,s,a,p)));return o.push((await this.lib.arc(e,t,i,n,s,a,l,!0,p))),this._drawable('arc',o,p)}async curve(e,t){const i=this._options(t);return this._drawable('curve',[await this.lib.curve(e,i)],i)}async polygon(e,t){const i=this._options(t),n=[];if(i.fill)if('solid'===i.fillStyle)n.push((await this.lib.solidFillPolygon(e,i)));else{const t=this.computePolygonSize(e),s=[[0,0],[t[0],0],[t[0],t[1]],[0,t[1]]],a=await this.lib.patternFillPolygon(s,i);a.type='path2Dpattern',a.size=t,a.path=this.polygonPath(e),n.push(a)}return n.push((await this.lib.linearPath(e,!0,i))),this._drawable('polygon',n,i)}async path(e,t){const i=this._options(t),n=[];if(!e)return this._drawable('path',n,i);if(i.fill)if('solid'===i.fillStyle){n.push({type:'path2Dfill',path:e,ops:[]})}else{const t=this.computePathSize(e),s=[[0,0],[t[0],0],[t[0],t[1]],[0,t[1]]],a=await this.lib.patternFillPolygon(s,i);a.type='path2Dpattern',a.size=t,a.path=e,n.push(a)}return n.push((await this.lib.svgPath(e,i))),this._drawable('path',n,i)}}class G extends F{constructor(e,t){super(e),this.genAsync=new X(t||null,this.canvas)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}async line(e,t,i,n,s){const a=await this.genAsync.line(e,t,i,n,s);return this.draw(a),a}async rectangle(e,t,i,n,s){const a=await this.genAsync.rectangle(e,t,i,n,s);return this.draw(a),a}async ellipse(e,t,i,n,s){const a=await this.genAsync.ellipse(e,t,i,n,s);return this.draw(a),a}async circle(e,t,i,n){const s=await this.genAsync.circle(e,t,i,n);return this.draw(s),s}async linearPath(e,t){const i=await this.genAsync.linearPath(e,t);return this.draw(i),i}async polygon(e,t){const i=await this.genAsync.polygon(e,t);return this.draw(i),i}async arc(e,t,i,n,s,a,l=!1,o){const r=await this.genAsync.arc(e,t,i,n,s,a,l,o);return this.draw(r),r}async curve(e,t){const i=await this.genAsync.curve(e,t);return this.draw(i),i}async path(e,t){const i=await this.genAsync.path(e,t);return this.draw(i),i}}const V='undefined'!=typeof document;class j{constructor(e){this.svg=e}static createRenderer(){return new E}get defs(){const e=this.svg.ownerDocument||V&&document;if(e&&!this._defs){const t=e.createElementNS('http://www.w3.org/2000/svg','defs');this.svg.firstChild?this.svg.insertBefore(t,this.svg.firstChild):this.svg.appendChild(t),this._defs=t}return this._defs||null}draw(e){const t=e.sets||[],i=e.options||this.getDefaultOptions(),n=this.svg.ownerDocument||V&&document,s=n.createElementNS('http://www.w3.org/2000/svg','g');for(const a of t){let e=null;switch(a.type){case'path':{e=n.createElementNS('http://www.w3.org/2000/svg','path'),e.setAttribute('d',this.opsToPath(a)),e.style.stroke=i.stroke,e.style.strokeWidth=i.strokeWidth+'',e.style.fill='none';break}case'fillPath':{e=n.createElementNS('http://www.w3.org/2000/svg','path'),e.setAttribute('d',this.opsToPath(a)),e.style.stroke='none',e.style.strokeWidth='0',e.style.fill=i.fill||null;break}case'fillSketch':{e=this.fillSketch(n,a,i);break}case'path2Dfill':{e=n.createElementNS('http://www.w3.org/2000/svg','path'),e.setAttribute('d',a.path||''),e.style.stroke='none',e.style.strokeWidth='0',e.style.fill=i.fill||null;break}case'path2Dpattern':{if(!this.defs)console.error('Cannot render path2Dpattern. No defs/document defined.');else{const t=a.size,s=n.createElementNS('http://www.w3.org/2000/svg','pattern'),l=`rough-${c(Math.random()*(Number.MAX_SAFE_INTEGER||999999))}`;s.setAttribute('id',l),s.setAttribute('x','0'),s.setAttribute('y','0'),s.setAttribute('width','1'),s.setAttribute('height','1'),s.setAttribute('height','1'),s.setAttribute('viewBox',`0 0 ${r(t[0])} ${r(t[1])}`),s.setAttribute('patternUnits','objectBoundingBox');const o=this.fillSketch(n,a,i);s.appendChild(o),this.defs.appendChild(s),e=n.createElementNS('http://www.w3.org/2000/svg','path'),e.setAttribute('d',a.path||''),e.style.stroke='none',e.style.strokeWidth='0',e.style.fill=`url(#${l})`}break}}e&&s.appendChild(e)}return s}fillSketch(e,t,i){let n=i.fillWeight;0>n&&(n=i.strokeWidth/2);const s=e.createElementNS('http://www.w3.org/2000/svg','path');return s.setAttribute('d',this.opsToPath(t)),s.style.stroke=i.fill||null,s.style.strokeWidth=n+'',s.style.fill='none',s}}class I extends j{constructor(e,t){super(e),this.gen=new M(t||null,this.svg)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(e){return this.gen.opsToPath(e)}line(e,t,i,n,s){const a=this.gen.line(e,t,i,n,s);return this.draw(a)}rectangle(e,t,i,n,s){const a=this.gen.rectangle(e,t,i,n,s);return this.draw(a)}ellipse(e,t,i,n,s){const a=this.gen.ellipse(e,t,i,n,s);return this.draw(a)}circle(e,t,i,n){const s=this.gen.circle(e,t,i,n);return this.draw(s)}linearPath(e,t){const i=this.gen.linearPath(e,t);return this.draw(i)}polygon(e,t){const i=this.gen.polygon(e,t);return this.draw(i)}arc(e,t,i,n,s,a,l=!1,o){const r=this.gen.arc(e,t,i,n,s,a,l,o);return this.draw(r)}curve(e,t){const i=this.gen.curve(e,t);return this.draw(i)}path(e,t){const i=this.gen.path(e,t);return this.draw(i)}}class $ extends j{constructor(e,t){super(e),this.genAsync=new X(t||null,this.svg)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}opsToPath(e){return this.genAsync.opsToPath(e)}async line(e,t,i,n,s){const a=await this.genAsync.line(e,t,i,n,s);return this.draw(a)}async rectangle(e,t,i,n,s){const a=await this.genAsync.rectangle(e,t,i,n,s);return this.draw(a)}async ellipse(e,t,i,n,s){const a=await this.genAsync.ellipse(e,t,i,n,s);return this.draw(a)}async circle(e,t,i,n){const s=await this.genAsync.circle(e,t,i,n);return this.draw(s)}async linearPath(e,t){const i=await this.genAsync.linearPath(e,t);return this.draw(i)}async polygon(e,t){const i=await this.genAsync.polygon(e,t);return this.draw(i)}async arc(e,t,i,n,s,a,l=!1,o){const r=await this.genAsync.arc(e,t,i,n,s,a,l,o);return this.draw(r)}async curve(e,t){const i=await this.genAsync.curve(e,t);return this.draw(i)}async path(e,t){const i=await this.genAsync.path(e,t);return this.draw(i)}}var Q={canvas(e,t){return t&&t.async?new G(e,t):new U(e,t)},svg(e,t){return t&&t.async?new $(e,t):new I(e,t)},createRenderer(){return U.createRenderer()},generator(e,t){return e&&e.async?new X(e,t):new M(e,t)}};return Q});
